<!DOCTYPE html>
<html>
<head>
  <title>防止食品过期</title>
  <style>
    /* 添加样式以美化页面 */
    body {
      font-family: Arial, sans-serif;
    }

    form {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 10px;
    }

    input[type="submit"] {
      padding: 5px 10px;
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
    }

    #result {
      margin-top: 20px;
      font-weight: bold;
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <h1>防止食品过期</h1>

  <form>
    <label for="foodName">食品名称：</label>
    <input type="text" id="foodName" required>

    <label for="expirationDate">过期日期：</label>
    <input type="date" id="expirationDate" required>

    <label for="reminderDays">提醒天数：</label>
    <input type="number" id="reminderDays" min="0" required>

    <input type="submit" value="添加食品" onclick="addFood()">
  </form>

  <h2>过期食品列表：</h2>
  <ul id="foodList"></ul>

  <div id="expirationAlert" class="hidden"></div>

  <script>
    // 存储过期食品的数组
    var foods = [];

    // 页面加载时，检查本地存储中是否存在保存的食品信息
    window.addEventListener("load", function() {
      var storedFoods = localStorage.getItem("foods");
      if (storedFoods) {
        foods = JSON.parse(storedFoods);
        updateFoodList();
      }
      startExpirationCheck(); // 启动过期日期检查
    });

    // 添加食品到数组并保存到本地存储
    function addFood() {
      var foodName = document.getElementById("foodName").value;
      var expirationDate = document.getElementById("expirationDate").value;
      var reminderDays = parseInt(document.getElementById("reminderDays").value);

      var food = {
        name: foodName,
        expiration: expirationDate,
        reminder: reminderDays
      };

      foods.push(food);
      updateFoodList();
      resetForm();

      // 将食品信息保存到本地存储
      localStorage.setItem("foods", JSON.stringify(foods));
    }

    // 更新过期食品列表
    function updateFoodList() {
      var foodList = document.getElementById("foodList");
      foodList.innerHTML = "";

      var currentDate = new Date();

      for (var i = 0; i < foods.length; i++) {
        var food = foods[i];
        var expirationDate = new Date(food.expiration);
        var reminderDays = food.reminder;

        var listItem = document.createElement("li");
        listItem.innerHTML = food.name + " - 过期日期：" + food.expiration + " - 提醒天数：" + food.reminder;

        var remainingDays = Math.ceil((expirationDate - currentDate) / (1000 * 60 * 60 * 24));
        var remainingDaysText = document.createElement("span");

        if (remainingDays < 0) {
          remainingDaysText.innerText = " - 产品已过期，请注意";
          listItem.style.backgroundColor = "#FF0000"; // 设置过期食品的背景色为红色
        } else if (reminderDays < remainingDays) {
          remainingDaysText.innerText = " - 产品临期，请注意";
          listItem.style.backgroundColor = "#FFC0CB"; // 设置临期食品的背景色为粉红色
        } else {
          remainingDaysText.innerText = " - 剩余天数：" + remainingDays;
        }

        listItem.appendChild(remainingDaysText);

        var deleteButton = document.createElement("button");
        deleteButton.innerHTML = "删除";
        deleteButton.addEventListener("click", createDeleteHandler(i)); // 创建删除按钮的事件处理程序

        listItem.appendChild(deleteButton);
        foodList.appendChild(listItem);
      }
    }

    // 创建删除按钮的事件处理程序
    function createDeleteHandler(index) {
      return function() {
        foods.splice(index, 1); // 从数组中删除食品
        updateFoodList(); // 更新过期食品列表
        localStorage.setItem("foods", JSON.stringify(foods)); // 更新本地存储中的食品信息
      };
    }

    // 重置表单
    function resetForm() {
      document.getElementById("foodName").value = "";
      document.getElementById("expirationDate").value = "";
      document.getElementById("reminderDays").value = "";
    }

    // 启动过期日期检查
    function startExpirationCheck() {
      setInterval(checkExpirationDates, 1000 * 60 * 60 * 24); // 每天检查一次过期日期
    }

    // 检查过期日期并显示提醒
    function checkExpirationDates() {
      var currentDate = new Date();

      for (var i = 0; i < foods.length; i++) {
        var food = foods[i];
        var expirationDate = new Date(food.expiration);
        var reminderDays = food.reminder;

        var remainingDays = Math.ceil((expirationDate - currentDate) / (1000 * 60 * 60 * 24));

        if (remainingDays < 0) {
          showExpirationAlert(food.name + " 已过期，请注意");
        } else if (reminderDays < remainingDays) {
          showExpirationAlert(food.name + " 即将过期，请注意");
        }
      }
    }

    // 显示过期提醒
    function showExpirationAlert(message) {
      var expirationAlert = document.getElementById("expirationAlert");
      expirationAlert.innerText = message;
      expirationAlert.classList.remove("hidden");
    }
  </script>
</body>
</html>
